// ==UserScript==
// @name         F95 - Threads
// @version      1.0.0
// @description  Seen
// @author       Anonymous
// @match        https://f95zone.com/*
// @require      https://code.jquery.com/jquery-3.2.1.min.js
// @require      https://cdnjs.cloudflare.com/ajax/libs/izimodal/1.5.1/js/iziModal.min.js
// @resource     spectre https://raw.githubusercontent.com/jvc06042017/f95-threads/master/spectre.min.css
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// @grant        GM_getResourceText
// ==/UserScript==

!function(t){var e={};function a(n){if(e[n])return e[n].exports;var d=e[n]={i:n,l:!1,exports:{}};return t[n].call(d.exports,d,d.exports,a),d.l=!0,d.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=4)}([function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={getTitleInfo:function(t){return{name:t.replace(/\[.*?\]/g,"").trim(),tags:t.match(/\[.*?\]/g)}},getUrlFromId:function(t){return"https://f95zone.com/threads/"+t},getThreads:function(){var t=GM_getValue("threads");return t&&"undefined"!==t?JSON.parse(t):[]},saveThreads:function(t){GM_setValue("threads",JSON.stringify(t))}},d=n;e.default=d},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={init:function(t){var e=[];$("div.titleText > h3.title").each(function(){var a,n=$(this),d=n.text().replace(/\s+/g," ").trim(),o=n.find("a:not(.prefixLink, .unreadLink)"),r=o.attr("href").match(/\.(.*?)\//g)[0].slice(1,-1);t.forEach(function(t){if(t.id===r)return a=t,!1}),a&&(o.addClass(a.desc),"bad"!==a.desc&&a.title!==d&&e.push(o))}),setInterval(function(){e.forEach(function(t){return t.toggleClass("white-flash")})},750),GM_addStyle("\n        .good {\n            color: #008f5a !important;\n            cursor: pointer;\n        }\n        .waiting {\n            color: #0696BB !important;\n            cursor: pointer;\n        }\n        .downloaded {\n            color: #696969 !important;\n            cursor: pointer;\n        }\n        .bad {\n            color: #710 !important;\n            cursor: pointer;\n        }\n        .white-flash {\n            color: #FFF !important;\n        }\n    ")}},d=n;e.default=d},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,d=(n=a(0))&&n.__esModule?n:{default:n};function o(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.threadInfo={id:$("#search_bar_thread").val(),title:$("div.titleBar > h1").text().replace(/\s+/g," ").trim()},this.addEventListener(),this.addButtons()}var e,a,n;return e=t,(a=[{key:"addEventListener",value:function(){var t=this;$(document).on("keydown",function(e){if(e.ctrlKey)switch(e.keyCode){case 100:t.threadInfo.desc="bad",t.addThread();break;case 101:t.threadInfo.desc="waiting",t.addThread();break;case 102:t.threadInfo.desc="good",t.addThread();break;case 103:t.threadInfo.desc="downloaded",t.addThread();break;case 96:t.removeThread()}})}},{key:"addButtons",value:function(){var t=this,e=$('\n            <div style="position: absolute; width:100%; text-align:center; top:0;">\n                <button data-add="good">Good</button>\n                <button data-add="waiting">Waiting</button>\n                <button data-add="downloaded">Downloaded</button>\n                <button data-add="bad">Bad</button>\n            </div>\n        ');$(window).scroll(function(){var t=$(window).scrollTop();0===t?e.css("top",0):e.css("top",50+t)}),e.appendTo(document.body),e.on("click","[data-add]",function(e){var a=$(e.currentTarget);t.threadInfo.desc=a.data("add"),t.addThread()})}},{key:"addThread",value:function(){for(var t=d.default.getThreads(),e=!1,a=0,n=t.length;a<n;a++)if(t[a].id===this.threadInfo.id){t[a]=this.threadInfo,e=!0;break}e||t.push(this.threadInfo),d.default.saveThreads(t)}},{key:"removeThread",value:function(){var t=this,e=d.default.getThreads();e=e.filter(function(e){return e.id!==t.threadInfo.id}),d.default.saveThreads(e)}}])&&o(e.prototype,a),n&&o(e,n),t}();e.default=r},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,d=(n=a(0))&&n.__esModule?n:{default:n};function o(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$modal={},this.lists={good:[],waiting:[],downloaded:[],bad:[]},e.forEach(function(t){a.lists[t.desc].push(t)}),this.appendToBody(),this.bindEvent(),this.addThreads(e)}var e,a,n;return e=t,(a=[{key:"appendToBody",value:function(){this.$modal=$('\n        <div id="f95-modal" class="spectre-modal">\n            <a href="#close" class="spectre-modal-overlay"></a>\n            <div class="spectre-modal-container">\n                <div class="spectre-modal-header">\n                    <a href="#close" class="spectre-btn spectre-btn-clear spectre-float-right"></a>\n                    <div class="spectre-modal-title spectre-h5">F95 - Threads</div>\n                </div>\n                <div class="spectre-modal-body">\n                    <div class="spectre-content">\n                        <div class="spectre-container">\n                            <div class="spectre-columns">\n                                <div class="spectre-column col-3">\n                                    <h1 data-check="good">Good</h1>\n                                    <input data-search="good" type="text">\n                                    <div id="good-list"></div>\n                                </div>\n                                <div class="spectre-column col-3">\n                                    <h1 data-check="waiting">Waiting</h1>\n                                    <input data-search="waiting" type="text">\n                                    <div id="waiting-list"></div>\n                                </div>\n                                <div class="spectre-column col-3">\n                                    <h1 data-check="downloaded">Downloaded</h1>\n                                    <input data-search="downloaded" type="text">\n                                    <div id="downloaded-list"></div>\n                                </div>\n                                <div class="spectre-column col-3">\n                                    <h1 data-check="bad">Bad</h1>\n                                    <input data-search="bad" type="text">\n                                    <div id="bad-list"></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="modal-footer">\n                    ...\n                </div>\n            </div>\n        </div>'),GM_addStyle("\n            .good-card {\n                color: white !important;;\n                background-color: #008f5a !important;\n            }\n            .waiting-card {\n                color: white !important;;\n                background-color: #0696BB !important;\n            }\n            .downloaded-card {\n                color: white !important;;\n                background-color: #696969 !important;\n            }\n            .bad-card {\n                color: white !important;;\n                background-color: #710 !important;\n            }\n        "),$(document.body).append(this.$modal);var t=GM_getResourceText("spectre");GM_addStyle(t)}},{key:"bindEvent",value:function(){var t=this;$(document).on("keyup",function(e){104===e.keyCode&&t.$modal.addClass("spectre-active")}),this.$modal.find(".c-modal-background, .close-modal").click(function(){return t.$modal.removeClass("spectre-active")}),this.$modal.on("click","[data-check]",function(e){var a=t.lists[$(e.currentTarget).data("check")],n=0;a.forEach(function(e){var d=t.$modal.find('[data-id="'.concat(e.id,'"]'));d.find("i").remove();var o=d.attr("href");$.get(o,function(t){var o=$(t).find("div.titleBar > h1").text().trim(),r=$("<i/>",{class:"fa",style:"color: black; float: left;"});if(r.addClass(e.title!==o?"fa-exclamation":"fa-times"),d.prepend(r),++n===a.length){var i=$("<span/>",{text:" - Done",style:"color: green"});$(".c-modal-card-title.c-dark").append(i),setTimeout(function(){return i.remove()},3e3)}})})}),this.$modal.on("keyup","[data-search]",function(e){var a=$(e.currentTarget),n=t.lists[a.data("search")],d=a.val().toLowerCase();n.forEach(function(e){var a=t.$modal.find('[data-id="'.concat(e.id,'"]'));e.title.toLowerCase().includes(d)?a.show():a.hide()})}),$("#saveThreads").click(function(){var t=d.default.getThreads(),e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t))),e.setAttribute("download","savedThreads.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}),$("#uploadThreads").click(function(){var t=document.createElement("input");t.setAttribute("type","file"),t.style.display="none",document.body.appendChild(t),t.addEventListener("change",function(t){var e=t.target.files[0];if(e){var a=new FileReader;a.onload=function(t){GM_setValue("threads",t.target.result),location.reload()},a.readAsText(e)}}),t.click()})}},{key:"addThreads",value:function(t){var e=this;for(var a in this.lists){var n=$("<span/>",{text:" (".concat(this.lists[a].length,")")});this.$modal.find('[data-check="'.concat(a,'"]')).append(n)}t.forEach(function(t){var a=$("<a/>",{text:t.title.replace(/\[.*?\]/g,"").trim(),title:null!==t.title.match(/\[.+?\]/g)?t.title.match(/\[.+?\]/g).join("  "):"",class:"c-list-group-item ".concat(t.desc,"-card"),"data-id":t.id,href:d.default.getUrlFromId(t.id)});e.$modal.find("#".concat(t.desc,"-list")).append(a)})}}])&&o(e.prototype,a),n&&o(e,n),t}();e.default=r},function(t,e,a){"use strict";var n=r(a(3)),d=r(a(2)),o=r(a(1));function r(t){return t&&t.__esModule?t:{default:t}}var i=r(a(0)).default.getThreads();new n.default(i),window.location.href.includes("https://f95zone.com/threads/")?new d.default:o.default.init(i)}]);