// ==UserScript==
// @name         F95 - Threads
// @version      1.0.0
// @description  Seen
// @author       Anonymous
// @match        https://f95zone.com/*
// @require      https://code.jquery.com/jquery-3.2.1.min.js
// @resource     cModal todo new url
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// @grant        GM_getResourceText
// ==/UserScript==

!function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},
a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={getTitleInfo:function(e){return{name:e.replace(/\[.*?\]/g,"").trim(),tags:e.match(/\[.*?\]/g)}},getUrlFromId:function(e){return"https://f95zone.com/threads/"+e},getThreads:function(){var e=GM_getValue("threads");return e?JSON.parse(e):[]},saveThreads:function(e){GM_setValue("threads",JSON.stringify(e))}},o=n;t.default=o},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={init:function(e){var t=[];$("div.titleText > h3.title").each(function(){var a,n=$(this),o=n.text().replace(/\s+/g," ").trim(),d=n.find("a:not(.prefixLink, .unreadLink)"),r=d.attr("href").match(/\.(.*?)\//g)[0].slice(1,-1);e.forEach(function(e){if(e.id===r)return a=e,!1}),a&&(d.addClass(a.desc),"bad"!==a.desc&&a.title!==o&&t.push(d))}),setInterval(function(){t.forEach(function(e){return e.toggleClass("white-flash")})},750),GM_addStyle("\n        .good {\n            color: #008f5a !important;\n            cursor: pointer;\n        }\n        .waiting {\n            color: #0696BB !important;\n            cursor: pointer;\n        }\n        .downloaded {\n            color: #696969 !important;\n            cursor: pointer;\n        }\n        .bad {\n            color: #710 !important;\n            cursor: pointer;\n        }\n        .white-flash {\n            color: #FFF !important;\n        }\n    ")}},o=n;t.default=o},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=a(0))&&n.__esModule?n:{default:n};function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.threadInfo={id:$("#search_bar_thread").val(),title:$("div.titleBar > h1").text().replace(/\s+/g," ").trim()},this.addEventListener()}var t,a,n;return t=e,(a=[{key:"addEventListener",value:function(){var e=this;$(document).on("keydown",function(t){if(t.ctrlKey)switch(t.keyCode){case 100:e.threadInfo.desc="bad",e.addThread();break;case 101:e.threadInfo.desc="waiting",e.addThread();break;case 102:e.threadInfo.desc="good",e.addThread();break;case 103:e.threadInfo.desc="downloaded",e.addThread();break;case 96:e.removeThread()}})}},{key:"addThread",value:function(){for(var e=o.default.getThreads(),t=!1,a=0,n=e.length;a<n;a++)if(e[a].id===this.threadInfo.id){e[a]=this.threadInfo,t=!0;break}t||e.push(this.threadInfo),o.default.saveThreads(e)}},{key:"removeThread",value:function(){var e=this,t=o.default.getThreads();t=t.filter(function(t){return t.id!==e.threadInfo.id}),o.default.saveThreads(t)}}])&&d(t.prototype,a),n&&d(t,n),e}();t.default=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=a(0))&&n.__esModule?n:{default:n};function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$modal={},this.lists={good:[],waiting:[],downloaded:[],bad:[]},t.forEach(function(e){a.lists[e.desc].push(e)}),this.appendToBody(),this.bindEvent(),this.addThreads(t)}var t,a,n;return t=e,(a=[{key:"appendToBody",value:function(){this.$modal=$('\n        <div id="f95-modal" class="c-modal">\n            <div class="c-modal-background"></div>\n            <div class="c-modal-card">\n                <header class="c-modal-card-head c-dark">\n                    <p class="c-modal-card-title c-dark">F95 - Threads</p>\n                    <span id="uploadThreads" class="fa fa-upload" style="color: white; margin-right:10px"></span>\n                    <span id="saveThreads" class="fa fa-save" style="color: white; margin-right:10px"></span>\n                    <button class="c-delete close-modal" aria-label="close"></button>\n                </header>\n                <section class="c-modal-card-body c-dark c-scrollbar" style="display:flex">\n                    <div class="c-columns">\n                        <div class="c-column c-text-center" style="display:flex; flex-direction: column">\n                            <h1 data-check="good" class="c-light">Good</h1>\n                            <input data-search="good" type="text" class="c-dark-input c-light">\n                            <div id="good-list" style="overflow-y: scroll"></div>\n                        </div>\n                        <div class="c-column c-text-center" style="display:flex; flex-direction: column">\n                            <h1 data-check="waiting" class="c-light">Waiting</h1>\n                            <input data-search="waiting" type="text" class="c-dark-input c-light">\n                            <div id="waiting-list" style="overflow-y: scroll"></div>\n                        </div>\n                        <div class="c-column c-text-center" style="display:flex; flex-direction: column">\n                            <h1 data-check="downloaded" class="c-light">Downloaded</h1>\n                            <input data-search="downloaded" type="text" class="c-dark-input c-light">\n                            <div id="downloaded-list" style="overflow-y: scroll"></div>\n                        </div>\n                        <div class="c-column c-text-center" style="display:flex; flex-direction: column">\n                            <h1 data-check="bad" class="c-light">Bad</h1>\n                            <input data-search="bad" type="text" class="c-dark-input c-light">\n                            <div id="bad-list" style="overflow-y: scroll"></div>\n                        </div>\n                    </div>\n                </section>\n                <footer class="c-modal-card-foot c-dark field is-grouped is-grouped-right">\n                    <button class="c-button close-modal is-link">Close</button>\n                </footer>\n            </div>\n        </div>'),GM_addStyle("\n            .good-card {\n                color: white !important;;\n                background-color: #008f5a !important;\n            }\n            .waiting-card {\n                color: white !important;;\n                background-color: #0696BB !important;\n            }\n            .downloaded-card {\n                color: white !important;;\n                background-color: #696969 !important;\n            }\n            .bad-card {\n                color: white !important;;\n                background-color: #710 !important;\n            }\n        "),$(document.body).append(this.$modal);var e=GM_getResourceText("cModal");GM_addStyle(e)}},{key:"bindEvent",value:function(){var e=this;$(document).on("keyup",function(t){104===t.keyCode&&e.$modal.addClass("c-is-active")}),this.$modal.find(".c-modal-background, .close-modal").click(function(){return e.$modal.removeClass("c-is-active")}),this.$modal.on("click","[data-check]",function(t){var a=e.lists[$(t.currentTarget).data("check")],n=0;a.forEach(function(t){var o=e.$modal.find('[data-id="'.concat(t.id,'"]'));o.find("i").remove();var d=o.attr("href");$.get(d,function(e){var d=$(e).find("div.titleBar > h1").text().trim(),r=$("<i/>",{class:"fa",style:"color: black; float: left;"});if(r.addClass(t.title!==d?"fa-exclamation":"fa-times"),o.prepend(r),++n===a.length){var i=$("<span/>",{text:" - Done",style:"color: green"});$(".c-modal-card-title.c-dark").append(i),setTimeout(function(){return i.remove()},3e3)}})})}),this.$modal.on("keyup","[data-search]",function(t){var a=$(t.currentTarget),n=e.lists[a.data("search")],o=a.val().toLowerCase();n.forEach(function(t){var a=e.$modal.find('[data-id="'.concat(t.id,'"]'));t.title.toLowerCase().includes(o)?a.show():a.hide()})}),$("#saveThreads").click(function(){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(e.threads))),t.setAttribute("download","savedThreads.json"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}),$("#uploadThreads").click(function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",document.body.appendChild(e),e.addEventListener("change",function(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){GM_setValue("threads",e.target.result),location.reload()},a.readAsText(t)}}),e.click()})}},{key:"addThreads",value:function(e){var t=this;for(var a in this.lists){var n=$("<span/>",{text:" (".concat(this.lists[a].length,")")});this.$modal.find('[data-check="'.concat(a,'"]')).append(n)}e.forEach(function(e){var a=$("<a/>",{text:e.title.replace(/\[.*?\]/g,"").trim(),title:null!==e.title.match(/\[.+?\]/g)?e.title.match(/\[.+?\]/g).join("  "):"",class:"c-list-group-item "+e.desc+"-card","data-id":e.id,href:o.default.getUrlFromId(e.id)});t.$modal.find("#"+e.desc+"-list").append(a)})}}])&&d(t.prototype,a),n&&d(t,n),e}();t.default=r},function(e,t,a){"use strict";var n=r(a(3)),o=r(a(2)),d=r(a(1));function r(e){return e&&e.__esModule?e:{default:e}}var i=r(a(0)).default.getThreads();console.log(i),new n.default(i),window.location.href.includes("https://f95zone.com/threads/")?new o.default:d.default.init(i)}]);